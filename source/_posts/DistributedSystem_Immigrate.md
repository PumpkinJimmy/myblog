---
date: 2021-10-15 14:23:29
---
# 分布式系统——代码迁移
## 为什么要代码迁移（待完善）
- 计算贴近数据，提供性能

## 代码迁移模型
- CS: Client-Server 基本，代码、计算和资源都在服务端，不存在代码迁移
- REV: Remote Evaluation 

  执行前：代码在客户端，其余在服务端

  执行后：代码被迁移到服务端执行

  典型例子：远程编程，常见于利用服务器算力的场景

- CoD: Code on Demand

  执行前：只有代码在服务端，其余都在本地

  执行后：代码下载到本地，执行本地计算

  常见于下载APP。

- MA: Mobile Agent

## 强/弱可移动性

迁移要考虑的组件：
- 代码段
- 数据段（包括栈）
- 执行状态：进程上下文

### 弱移动性

**仅仅移动代码段和数据段的迁移方式。**

简单地说就是终止进程，将代码和数据拷贝到另一个机器上然后重启。

只要求应用在两个在平台是可移植的较简单。

### 强移动性

把代码段、数据段、**执行状态**迁移到另一个机器。

- 迁移
- 克隆（热迁移）

## 异构系统中的迁移

没有特别好的方法。

目前可选的只有*虚拟化*：
- 进程虚拟机：依赖解释器的语言
- 虚拟机监控器：也就是“容器”，把整个OS环境都迁移过去（比如Docker）。

## 迁移虚拟机
迁移镜像：三种方案
- 停机迁移
- 推送脏页面
- 按需拉取页面

### 推送脏页面
潜在问题：
- 数据不一致
- 若脏页面生成速度大于迁移网络带宽，则**迁移可能永远不会完成**

### 迁移性能

即便是热迁移，仍然存在短时间的宕机时间（服务不可用时间）