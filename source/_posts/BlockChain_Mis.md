---
title: 区块链的应用
abbrlink: 6e71cda0
date: 2021-10-21 10:05:42
---
# 区块链的应用
## 区块链分层
- 业务层
  
  支持业务层面的应用

- 共识层
  
  PoW/PoX共识机制

- 网络层
  
  P2P分布式结构

- 数据层
- 物理层

## 区块链的核心技术
- 密码学
  
  数字签名，哈希指针，共识算法

- 博弈论
  
  激励驱动的博弈论行为建模

- P2P网络
  
  去中心化分布式系统


## P2P网络基础
- Structured Network
  
  通过维护DHT(Distributed Hash Table)来维护网络、快速访问节点。

  限制较大，要求各个节点具有网络的完全信息。
  
- Unstructured Network
  
  无服务质量承诺，采用Flooding发现节点。

  可拓展性强。

### 比特币的P2P网络
- 采用非结构化P2P网络
- 发现节点的实现：
  1. （少）使用预先配置的IP地址
  2. （已弃用）使用互联网中继聊天
  3. **基于DNS的发现服务**

一个节点通常维护30个连接。

## 比特币网络经典工作流

### 转账交易
设A向B转账
1. 个人用户使用B的地址标识B
2. A使用B的地址与自己的私钥构造请求交易
3. 上传交易到Mempool
4. 等待一段时间，在Full Node上查看链，发现自己的交易已经上链生效了

### 挖矿
1. 矿工从Mempool选择区块
2. 做PoW
3. 成功的矿工将打包的区块广播出来

### 交易确认
1. 收到区块：一个节点收到邻居的一个区块的邀请信息，若该区块未被加入本地链，则开始检验区块
2. 检验区块：做一次哈希，确认PoW Nounce是否符合当前难度
3. 若检验通过，则区块加入本地链中，并被继续向外广播。交易得到这个节点的确认。

## 再谈比特币共识
### 比特币在追求什么共识

总的来说，比特币希望达成一条**全网统一的区块链**。

统一的一条区块链意味着：
- 统一的交易记录（统一账本）
- 统一的版本和协议


### 网络延迟分叉

一个打包并完成PoW的区块要传遍网络是需要时间的。

**在到达全网节点之前，节点可能自己先挖出了别的区块**。此时会导致网络延迟分叉（区分软分叉/硬分叉/恶意分叉等人为分叉）

比特币网络采用如下机制处理这一问题：
- 最长链机制：Full Node应该缓存多个分叉，并只认可当前最长的一个作为有效账本
- 放回交易：当非最长链被确认为失效时，将其中的交易放回Mempool中。