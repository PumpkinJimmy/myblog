---
title: OS复习
tags:
  - 专业课
abbrlink: 1685efe6
date: 2021-07-06 13:10:15
updated: 2021-07-06 13:10:15
---
# OS复习
## 计组
### 术语
- 中断
  - 由计算机系统内部或外部引起的，将一个正在运行的进程暂停，并将控制权交给专门的处理程序的一个事件。
- 程序状态字（PSW）
  - 包含当前进程运行状态的存储字，包含内容如内存使用、是否允许中断、运行模式等
- 多级存储体系
  - 不使用单一存储器而是使用多类价格递减、速度递减、容量递增的存储器构成的分层存储体系。
- 空间局部性
  - 访问操作在空间上存在聚集
- 时间局部性
  - 相较其他位置，最近访问过的位置接下来更有可能被访问到
- 异步操作
  - 指一个操作相对于另一个操作的时序是不明确的，或者说相对于另一个操作而言，不是有规律地或可预期地发生的
## OS Intro
### 概念
操作系统的三个目标：
- 易用：让计算机易于使用
- 有效：允许更高效地利用计算机资源
- 可拓展：容易为OS开发新的功能

OS的三个身份：
- **用户与计算机的接口**
  - 对应易用性
  - 屏蔽计算机的底层细节，提供接口
  - 三个层次的接口：ISA，ABI，API
- **资源管理器**
  - 对应高效性
- 可拓展的平台：对应可拓展性
- OS类别
  - 批处理
  - 多道批处理
  - 分时系统
  - *实时系统

### 术语
- 作业
  - 要运行的单个程序，可能包括数据，以及执行指令
- 批处理
  - 将作业**成批提交给计算机，然后不再干预**
- 多道批处理系统
  - 支持两个及以上的计算机任务并发运行的系统
- 分时系统
  - 允许多个*用户*（而不仅仅是多个作业）共享处理器时间的系统。
- 实时系统
  - 支持执行实时任务（存在完成任务的最后期限）的系统
- 执行上下文
  - 程序执行的系统环境，包括处理器的寄存器的值、处理器当前的状态，资源的状态（如页表）等



## 进程模型
### 概念
- OS管理程序执行的目标
  - 实现系统资源共享
  - 实现单处理器上多道程序的切换
  - 充分利用处理器和IO设备
- 进程
  - 正在计算机上运行的程序的实体
  - 可以被处理器调度、可以分派的实体
  - 包含一组可执行指令、一个当前状态和一组相关系统资源
  - 处理器调度的独立单位
  - 资源分配的基本单位
- 进程的特征
  - 动态性：具有声明周期
  - 并发性：逻辑上多个进程同时在运行
  - 独立性：处理器调度和资源分配的独立单位
  - 异步性：进程之间独立地运行
  - 具有结构特征：进程映像
- 进程包含的元素
  - 标识符pid
  - 状态state
  - 优先级prio
  - 程序计数器pc
  - 内存指针memory pointer
  - 处理器上下文context(regs)
  - IO信息
- 六/七状态进程模型
  - 运行
  - 就绪
  - 阻塞
  - 挂起
  - 起始
  - 结束
- 挂起
  - 指的是**进程映像部分或全部换出到了外存中**
  - 挂起状态的出现是因为**在没有虚存的情况下，进程映像需要全部在内存中，进程才能正常运行**
### 术语解释
- 进程
  - 正在计算机上正在执行的，能够分配给处理器运行的，由一组程序代码（一组可执行代码）、与代码相关联的数据集、一个当前状态和一组相关系统资源表征的执行实体。
- 进程派生
  - OS为一个进程的显式请求创建一个新的进程，并指定该新进程的父进程为发起请求的进程
- 进程映像
  - 用户数据、用户程序、进程用户栈与系统栈以及进程控制块（PCB）的集合
  - 进程映像就是进程概念的实体
- 阻塞态
  - 进程由于某些原因（如IO操作、系统调用、缺页），进程继续执行的条件还未满足，因而还不能执行的状态。
- 就绪态
  - 进程做好准备，可以分派处理器立刻开始执行
- 抢占
  - 中断一个正在运行但还未结束的进程，并将处理器分派给另一个进程来执行的操作
- 进程切换
  - OS中断一个正在运行的进程、保存其执行上下文，并恢复另一个就绪进程的上下文、将控制权交给该就绪进程的过程。
- 挂起态
  - 进程并没有在执行的，且进程映像的部分或全部换出到了外存中的一种状态。
- 交换
  - 将某进程的一部分或全部移到辅存中
- 调度
- 特权指令
- 用户模式（用户态）
  - 处理器执行用户程序时所处的、不允许执行特权指令、不允许访问受保护内存、不允许直接访问IO的一种处理器运行状态。
- 系统模式（内核态）
  - 处理器执行系统内核程序时所处的、允许执行任何指令、允许访问任意内存以及直接使用IO的一种处理器特权运行状态。
- 模式切换
  - 处理器运行状态（特指内核/用户态）的切换
- 原语
- 内核
- 宏内核
- 微内核
## 并发问题
### 术语
- 可重用资源
  - 一次只能供一个进程使用，不会因为使用的消耗的资源
  - 处理器，IO通道，内存，外存，设备，文件，信号量
- 可消耗资源
  - 可以被创建和销毁的资源
  - 信号、消息、缓冲区数据
- 死锁
- 死锁预防
- 死锁避免
- 死锁检测
- 银行家算法
  - 也即**资源分配拒绝策略**，以安全状态为核心的死锁避免策略
- 安全状态
  - 至少存在一个不会导致死锁的资源分配序列的状态。等价于**所有进程都能运行到结束**
- 联合进程图
  - 呈现两个进程竞争资源的进展以及执行路径
- 资源分配图
  - 圈为进程，方框为资源，请求边和分配边
- 互斥
- 抢占
- 占有且等待
- 循环等待
- 饥饿
- 管道
- 内存屏障
- 消息
- 自旋锁
  - 一个进程在无限循环中执行，等待锁变量指明锁可用的互斥机制
- 哲学家就餐问题
- 竞态问题
  - 由于多个并发进程对共享变量的访问和操作导致执行的结果取决于并发进程指令执行的相对时序的问题
## 线程
- 线程的优点
  - 创建和终止的速度快
  - 切换的开销更小（因为保存和恢复的上下文较少）
  - 通信效率高：同一个线程派生出来的子线程天然地共享全局变量，不需要系统调用就可以访问共享资源。
- **线程不是系统资源分配的单位**，线程独占的资源主要是自己的处理器上下文和栈空间（以及thread_local静态）。
- 线程只有就绪-执行-阻塞三个状态，**线程没有终止态和挂起态**
- 用户级线程
  - 用户级线程是用户态模拟的线程
  - 对内核是不可见的
  - 该线程的切换不需要模式切换（需要内核态来处理）
  - 调度算法由用户程序实现
  - 朴素实现的问题：
    - 一个线程阻塞（如发起系统调用）会导致所有兄弟线程页阻塞（解决方案是注册回调，使用非阻塞调用）
    - 不能充分利用SMP
- 内核级线程
  - 可以充分利用SMP
  - 内核例程自身可以使用多线程
  - 最大的缺点是需要模式切换和上下文切换
- 宏内核的特点
  - 水平分层
  - 只有层与层之间相互通信
  - 若下层发生变动会影响到上层
  - 高性能
- 微内核的特点
  - 内核只包含最小功能集，其余服务均运行在内核态
  - 模块化
  - 垂直分层
  - 可拓展
  - 一致接口
  - 可靠性高：微内核可以被严格测试
  - 性能差
### 术语解释
- 线程
  - 轻量级进程，处理器调度执行的基本单位
- 线程控制块
- 用户级线程
- 内核线程
- 消息
## IO
### 名词解释
- 块
  - 作为块设备处理单元的一组二进制数据
- 面向块的设备
- 面向流的设备
- 程序控制IO
- 中断控制IO
- DMA
  - 一种IO控制模式。处理器向DMA控制器发送IO命令，DMA控制器负责处理主存与IO的数据交换；只有当所有数据块传输完成后DMA才通知控制器。
- IO通道：具有自己独立处理器甚至是独立存储空间的IO模块
- IO处理器：类似IO通道
- 设备IO（物理IO）
  - 将上层IO请求变成适当的IO指令序列和参数，使用缓冲技术提高利用率
- 逻辑IO
  - 将设备当成逻辑资源来使用，不管行设备控制细节。
- IO缓冲区
- 循环缓冲区
  - 多于两个的一组逻辑上循环的缓冲区
- spooling
  - 外围设备与处理器交换数据时为减少时延，同时将一个独占设备虚拟出多个逻辑上的设备实现独占设备共享，使用辅助存储器器（输入井，输出井）作为缓冲的IO技术
- 磁道
- 扇区
- 寻道时间
  - 磁头移动到目标磁道所需要的时间
- 磁头
- 磁盘缓存
- RAID

## 内存管理
### 概念
内存管理的首要目的：
- 满足多道程序并发

内存管理的需求：
- 重定位
- 共享
- 保护
- 逻辑组织
  - 分段
  - 便于提供多种层次上的内存保护
  - 便于模块化地组织和共享内存
- 物理组织
  - 分页
  - 主存和辅存的信息交换和管理

静态分区：内碎片
动态分区：
- 消除内碎片，产生外碎片
- 需要定期压缩来消除外碎片
- 放置算法
  - 最佳适配（最差）
  - 首次适配（通常最好）
  - 下次适配
- **伙伴系统**：固定分区和可变分区的折中
  - 只允许对齐2^k大小进行动态分区分配
- 
- 重定位
  - 逻辑地址：与当前数据在内存中的物理分配地址无关的访问地址
  - 相对地址是逻辑地址的一个例子
  - 一个简单粗暴的方法是基于一个基地址寄存器，也就是分段
- 分段
  - 将用户程序按逻辑划分为多个长度不等的部分，借助段表管理、基于基地址来计算物理地址的内存管理方案
  - 与动态分区管理的区别在于，动态分区管理为一个进程分配了一个分区。而分段可以为一个进程分配多个物理上不连续的段。
- 动态运行时加载
  - 可重定位加载（也称静态重定位）的缺点是在加载时通过地址空间的转换一次性将程序中的所有逻辑地址转换为物理地址。但如果要进程在执行过程中的物理地址总是在变化，那载入时绑定的物理地址就失效了。
  - 动态运行时加载其实就是在指令执行的那一刻再计算一个逻辑地址对应的物理地址。
  - 动态运行时加载的实际实现方案就是分页

### 虚拟存储器
虚拟地址：
虚拟内存的地址空间中的一个地址，该地址对应一个可以访问的存储位置，且如同它是主存的一部分。

虚拟存储器是如何提高系统利用率的：
1. 进程映像的部分驻留：任何特定进程只需要装入其部分的块，因此**内存中有足够大的空间放置更多的进程**
2. 进程可以拥有独立的、巨大的逻辑地址空间（甚至比物理内存本身还要大）：通过维护和切换页表，各个进程可以拥有很大的虚拟地址空间

页表项的构成：
- 控制位：表明该页的状态
- 页框号

多级页表：
- 主要作用是**减少页表所占的连续空间大小**
- 缺点是更慢的地址转换
- 基本方法是**一级页表下的每一个页表项对应存放了二级页表所在页框（的页框号）**。通过查一级页表可以得到二级页表所在的页，然后就可以查二级页表查到给定页号对应的页框号

反向页表（倒排页表）的项：
- 页号
- **进程标识符**：标识使用该页的进程
- 控制位：表明该页的状态

常规页表存在CR3页表切换，但反向页表整个OS只有一个，因为页表项中有进程标识符

### 分段 vs. 分页
- 虚拟内存实现和地址转换方面，分页能做的其实分段也能做
- 分页**几乎可以认为消除了内存碎片**
- 分段**容易支持共享和保护**，应位分段系统是可见的。

### 策略
- 调页
  - 请求调页
  - 预调页
- 放置策略
- 置换策略
  - OPT 最佳（不可实现）
  - LRU
  - FIFO
  - Clock
    - 为备选页添加一个访问位（R位）
- 驻留集管理
  - 置换范围
    - 全局：所有进程的页
    - 局部：当前进程的页
  - 进程页框分配策略
    - 静态：进程启动时确定进程能分配到的页框的数目
    - 动态：进程运行过程中动态调整分配到的页框数目
- 清除策略：对页的修改合适写入辅存中
- 加载控制（联系长程调度，作业调度）
- 挂起

### VSWS工作集管理策略


### 术语解释
- **重定位**
  - 将程序的逻辑地址空间变换成内存中的实际物理地址空间的过程
- 动态运行时加载
  - 只有在执行指令的之后才计算指令中使用的逻辑地址的物理位置的动态加载方式
- 动态分区
  - 将内存划分为可变长度的块分配给用户程序的内存管理方案
- 压缩：
  - 通过移动进程映像在内存中的物理位置，使得各个进程占用的内存空间连续，并使得空闲空间连成一片，从而消除内碎片
- 伙伴加载：固定分区和可变分区的折中
- 逻辑地址
  - 与当前数据在内存中的物理分配地址无关的访问地址
- 动态加载
  - 载入用户程序时动态地将进程载入到某个对用户程序来说未知的地址处的程序加载方式，要求用户程序使用逻辑地址而非物理地址
- 逻辑组织
  - 分段
  - 便于提供多种层次上的内存保护
  - 便于模块化地组织和共享内存
- 物理组织
  - 分页
  - 主存和辅存的信息交换和管理
- 共享
  - 允许多个进程受控地访问内存的同一个部分的机制
- 保护
  - 由硬件支持的静止进程非法访问某些内存未知的机制
- 分页
  - 将内存划分为大小固定且相等的块，借助页表来进行管理的内存管理方案
- 分段
  - 将用户程序按逻辑划分为多个长度不等的部分，借助段表管理、基于基地址来计算物理地址的内存管理方案
- 虚拟内存
  - 基于逻辑地址的动态运行时内存管理方案的，支持使用备用的存储空间（如辅存）来扩充主存和进程地址空间的存储管理技术
- 关联映射
- 内碎片
  - 分配给用户的内存中存在的不可利用的小内存片段
  - 通常存在于固定分区管理和页式管理
- 外碎片
  - 未分配给用户的内存中用户内存空间与用户内存空间之间的不可利用的小内存片段
  - 通常出现在动态分区管理和段式存储管理
- 页框
  - 物理内存空间划分而成的等大小的块
- 页
  - 分页式存储器系统中，具有一个逻辑地址的、长度固定的数据块。在虚拟存储器中，页也是辅存和主存交换数据的基本单位。
- 页框
  - 物理内存中用于保存一个页的数据的大小固定且与页大小相同的连续块。
- 缺页中断
- 页面放置策略
- 页面替换策略
- 页表
  - 记录每个页的页框号（如果确实在内存中）和页的状态（如是否在内存中，是否被访问过，是否被修改过等）
- 段表
- 页面抖动
  - 由于刚调出的页面立刻又需要访问，从而马上又调入，如此短时间内频繁地对个别页面调入调出地导致辅存IO繁忙而处理器利用率低的现象称为页面抖动。
- 驻留集
  - 进程已装入内存的页面的集合
- 工作集
  - 某段时间间隔内进程要访问的页面的集合

## 文件管理
- 物理文件结构
  - 连续分配
  - 链式分配
  - 索引分配
- 空闲空间管理
  - 位表
  - 链接空闲区：将可变长度的连续空闲区串成链表
  - 索引：将所有空闲空间视为一个索引分配的文件
  - 空间块列表：一种稀疏表示，将空闲块的块号放在一个线性表里。在空闲空间很多的时候表会非常的大，因此需要发在磁盘上，同时为了防止空闲空间分配的耗时过长，会将该表当作栈或者队列，然后将表的一部分放在内存中，提高速度。

### 术语
- 文件分配表
  - 指明文件在辅存中的物理位置的表
- 文件管理系统
  - 一组为文件的用户或使用文件的应用程序提供文件操作相关服务的系统软件
- 逻辑IO：使用户和应用程序能够访问文件记录
- 工作目录：相对于当前进程或者交互式用户而言的当前目录
- 记录组块：将记录组织成物理文件系统的块来执行IO的策略
- 定长组块：使用定长的记录，将若干完整记录保存到一个块中
- 变成跨越式组块：变长记录，并紧缩到块中，使得块中不存在未使用的空间，但可能某些记录会跨块
- 变长非跨越式组块：不允许跨块的变长组块
- 预分配：创建文件时预先声明文件的最大尺寸
- 卷：一组在辅存上可寻址的对操作系统或者应用程序连续的但在物理设备上不一定连续的扇区的集合构成的逻辑磁盘
- 磁盘分配表：等于空闲区分配表

## IO
### 术语
- 块
- 面向块的设备
- 面向流的设备
- 单缓冲
- 双缓冲
- 循环缓冲区
- 缓冲池
- 逻辑IO
  - 设备无关的、将IO设备当成逻辑资源来处理的软件IO模块
- 设备IO
  - 请求的操作和数据被转换成适当的IO指令、
- 中断驱动IO
- IO通道
- IO处理器
- DMA
  - 直接内存访问
- 寻道时间
- 旋转延迟
- 磁盘缓存
- 扇区
- 磁道
- 磁头
- 最短服务时间优先
  - 优先选择导致最小寻道时间的请求
- SCAN（电梯算法）
  - 要求磁头臂只沿一个方向移动，并在途中满足所有未完成的请求，直到到达这个方向的最后一个磁道或者该方向上没有其他请求为止才反转服务方向的一种磁盘IO调度算法
- C-SCAN
  - 只允许SCAN采用一个方向，到头之后立刻返回磁盘相反方向的末端，然后再次扫描
- RAID
  - 独立磁盘冗余阵列
### 概念
- IO子系统基本架构
  - 用户进程 - 逻辑IO - 设备IO - 调度与控制 - 硬件
  - 其中逻辑IO是一个统称，它通常是**设备无关层**
  - 设备IO也称*物理IO*，是负责产生设备特定的IO命令和参数
  - 调度与控制也称驱动层，涉及中断及其处理，是真正与设备直接通信的一层。通常IO缓冲区和磁盘调度也是在这一层完成
- RAID 
  - RAID是一组物理磁盘驱动器，而OS将其视作单个逻辑驱动器（磁盘冗余阵列）
  - 数据分布在物理驱动器阵列中（条带化）
  - 使用若能关于磁盘容量保存奇偶校验信息，数据具有可恢复性
  - RAID 0
    - 无冗余
    - 并发请求，高数据传送能力
  - RAID 1
    - 完全镜像备份
    - 完全冗余，易于恢复
    - 读性能有优势
  - RAID 2
    - 冗余
    - 汉明码纠错
    - 没有性能优势
    - 只适用于磁盘错误很多的情形
  - RAID 3 ~ 6
    - 冗余
    - 奇偶校验，从冗余数据和奇偶校验码中恢复
- 三种设备
  - 独占设备：如打印机
    
    独占设备的特点是**一个进程申请了该设备后，在该设备的使用完成之前，别的进程都不可以使用该设备**，如打印机不应该在同一张纸上打印不同进程要打印的东西
  
  - 分时共享设备：如磁盘
    
    分时共享设备的特点是：**同一时刻仍然不能有多个进程使用设备，但并发进程可以分时复用设备**，如进程的磁盘访问请求可以拆分成许多个簇的读写，这样可以处理某进程的若干个请求之后切换处理另一个进程的磁盘访问请求。
  
  - 虚拟设备：SPOOLing假脱机技术
    
    SPOOLing的特点是**通过输入井和输出井将一个独占式的物理设备虚拟出多个逻辑设备供多个进程共享**

- RAID

## 坑点
- 段相关的计算不要忘记检查段界限


## 错题

### 进程
- 设备分配不会创建新进程
- 管道是特殊的文件（或者说，只是具有文件管理系统的统一接口而没有辅存上的实体，类似设备文件），**管道只存在内存中**；**管道是半双工的通信，且类似生产者-消费者模型中的有界队列，读或者写都有可能阻塞**
- 题目有时要求“最大限度并发”，这是需要考虑一些不需要互斥的情况：
  - **某个共享变量没有写**
  - **三个以上的进程可以分别互斥来充分并发**
  - 考虑一种情况：进程P1、P2、P都用到了共享变量y，但**只有P3写了y**，此时**P1与P3、P2与P3分别互斥，使用两个不同的互斥锁，因为P1和P2之间是不必互斥的**
- 哲学家就餐问题如果不使用管程和条件变量，则n个位置只允许n-1个人同时就餐
- 注意银行家算法的安全状态时**存在一个安全的进程结束序列**。也就是说，只有当前存在一个进程可以运行结束还不行，必须**后续每一步都有一个进程能运行结束**

### 文件
- 打开文件的时候不必立即从辅存读入输入，**打开文件需要的是读入FCB(inode缓存)**
- 逻辑索引（索引文件）的目的是**加快在文件中定位特性数据的速度**，也就是数据库的索引查询服务，面向的是**用户**；物理索引（inode多级间接块）的目的是**管理分配给该文件的块**，面向的是**系统**
- 物理文件分配相关：
  - 连续分配：适合随机存取，难以扩容（顺序表）
  - 链表分配：不可随机存器，容易扩容（链表）
  - 索引分配：支持近似随机存取，也容易扩容
  - 注意FAT文件分配表作为一种原始的物理文件管理结构，等效于**同时继承了文件分配和空闲空间管理**
- 小心按簇分配会有少量的内碎片，换句话说，小心一个文件要分得完整的簇
- 所谓的**逻辑格式化**其实就是在磁盘上初始化物理文件系统的必要信息的过程