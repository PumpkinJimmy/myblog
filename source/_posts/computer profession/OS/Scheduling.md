---
title: Scheduling
date: 2021-06-22 10:23:18
updated: 2021-06-22 10:23:18
tags:
- 专业课
---
# 单处理器调度

以下主要讨论单处理器调度
## 基本类型
1. 长程调度（也称*作业调度*）
   
   这是最外围的调度，主要决策哪些**新建进程**可以进入系统执行，可以控制多道程序的并发度（因为进程越多每个进程分摊到的CPU性能越少）

   长程调度主要是批处理系统时代遗留下来的概念。当时的计算机系统资源非常紧缺，交互能力差，用户需要将批处理作业准备好放在外存排队等待长程调度调入执行。

2. 中程调度（负责*挂起进程*）
   
   与虚拟存储器紧密关联，决策进程的挂起/激活，决策交换哪一些内存（换出哪些页）

3. 短程调度（也称*分派*）
   
   决策下一个使用CPU的进程（通常实现为*分派器(dispatcher)*）

## 短程调度

### 两大类短程调度
1. 非抢占式
   
   **进程一旦分派到CPU，就一直运行到结束，或者由于阻塞主动让出CPU**。这种调度不允许抢占，

   主要用于专用操作系统，一般不用于通用操作系统。

2. 抢占式

### 短程调度的目标
- 公平：每个进程获得合理的CPU分额
- 效率：使得CPU和其他系统资源的利用率尽可能高
- 响应时间：从提交操作到开始输出结果的时间，主要影响交互体验
- 吞吐量：单位时间内完成的进程数
- 周转时间：任务从提交到结束（主要批处理系统的指标）
- *实时性：可以指定进程完成的最后期限。（只出现在实时操作系统上）

注意，几个衡量短程调度性能的量化指标：
1. 周转时间：从任务提交（到达、创建）到任务完成的时间。周转时间包含了等待的时间和实际处理的时间
2. **归一化周转时间**：归一化周转时间 = 周转时间/服务时间
   
   通常，服务时间更长的进程可以容忍更长的周转时间。

   观察公式发现归一化周转时间的下界是1，该指标越大，服务质量越差。

### 短程调度策略


以下介绍几种**非抢占式**的调度策略**只支持到多道程序，不支持分时**，事实上只适用多道批处理监控程序，不适用现代通用操作系统。

这些非抢占式调度策略的吞吐量都相对较大。

非抢占式的共同优点：
- 吞吐率相对高
- 管理开销通常比较低
- 实现简单

非抢占式的共同缺点：
- 不适用于实现分时系统和事务管理系统

1. 先来先服务（FCFS）
   - 这种策略是非抢占式的。
   - 当前进程结束后，分派最早到达就绪队列的进程，分派的进程一直运行到结束。
   - 优点是容易实现，**公平**。
   - 缺点是：
     - 效率低：短进程得不到优先分派，
     - CPU利用率低：没有IO让权等待，容易导致CPU密集型进程等待IO密集型执行完
   - 该方法对长进程有利，对CPU密集型有利，对短进程不利，对IO密集型不利

2. 最短进程优先（SPN）
   - 该策略同样是非抢占的。
   - 每次调度选取*运行时间最短*的进程分派。
   - 优点：
     - 短进程的周转时间显著改善
     - 保证**最小平均周转时间最短**
   - 缺点：
     - 长进程饿死

3. 最高响应比优先（HRRN）
   - 该策略是非抢占的。
   - 每次选取**响应比最大的进程调度**。

      其中响应比的公式是：
      $$
         RR = \frac{w + s}{s}
      $$

      其中$s$表示估计的进程运行总时间（服务时间），$w$表示进程已经等待的时间。

   - 这个方法相当于FCFS和SPN的混合。
   - 优点——**结合了FCFS和SPN的优点**
     - 相对公平——长进程不会饿死
     - 兼顾效率——短进程优先度较高
   - 缺点：管理开销可能会大一些

**抢占式策略的共同优点**：
- 支持交互：分时策略具有短响应时间
- 充分并发：实现了在一个物理CPU上并发，也即逻辑上并行的特性。
- 避免个别CPU密集型进程长时间占据独占CPU

抢占式策略的共同问题：
- 管理开销问题：反复中断，频繁抢占，管理开销可能会比较大，降低CPU利用率（尤其对于
- 效率问题

1. 时间片轮转（Round Robin, RR）
   
   相当于抢占式分时FCFS。

   先来的进程先运行，**但当进程运行满一个时间片，若未结束，则进程被抢占，调入就绪队列中的下一个进程的执行**

   优点：
   - 相对公平
   - 易于实现
   
   缺点：
   - 效率不够高
   - 对IO密集型程序不公平
     
     IO密集型程序只需要少量CPU时间发出IO指令就让出CPU并开始等待IO，但时间片轮转对其没有优先处理，导致**看似公平地为每个进程分派CPU时间，但对于IO密集型进程，主要消耗的时间是IO时间，就算分得公平的CPU时间也不意味着能得到公平的效率**

2. 虚拟轮转（VRR）
   
   时间片轮转的变式。
   
   对RR做改进：IO完成后解除阻塞的进程进入辅助队列。**优先从辅助队列中分派进程执行**。这种策略实质上让IO完成的进程优先获得CPU，解决原始时间片轮转对IO密集型进程不公平的问题。

3. 最短剩余优先
   
   相当于抢占式分时SPN策略。

   优先分派*估计剩余运行时间最短*的进程先运行，当有估计剩余运行时间更短的进程进入，则立即剥夺当前进程，分派剩余运行时间更短的进程进入。

4. 最高优先级优先（HPF）
   - 为每个进程分派一个*优先级*。**每次总是分派优先级最高的进程执行。若有多个优先级相同的就绪进程**
   - 实现策略通常是**每个优先级有自己的就绪队列**，然后在就绪队列内执行某种调度（如时间片轮转）
   - 优先级策略的类别：
     1.  静态优先级（进程创建时指定）
     2.  动态优先级（在运行过程中动态调整）
     3.  非抢占式优先级（当前进程不可抢占）
     4.  抢占式优先级调度（当某个更高优先级的进程就绪，可以抢占当前进程）
   - **实际上，只要将各种调度策略的考量引入动态优先级计算更新公式中，最高优先级策略可以实现乃至融合各种调度策略**

   

5. 多级队列反馈（MF/FB）
   - 该策略是抢占式的、基于时间片的
   - 采用动态优先级机制
   - 每个优先级各自有一条就绪队列
   - 采用反馈机制：
     - **高优先队列中的进程优先调度，但得到的时间片较少；低优先级进程得到的时间片较多**
     - 初始新建的进程为最高优先级
     - 每次进程被抢占，优先级就降低

### 公平共享调度

以归属同一用户（组）的进程集来决策处理器调度。

公式：
$$
   \mathrm{CPU}_i = \mathrm{CPU}_{i-1} / 2\\
   \mathrm{GCPU}_i = \mathrm{GCPU}_{i-1} / 2
$$
$$
   P_i = Base + \mathrm{CPU}_i / 2 + \mathrm{GCPU}_i / 4W
$$

注意