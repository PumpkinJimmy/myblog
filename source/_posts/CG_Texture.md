---
title: 纹理
abbrlink: 59b9f116
date: 2021-10-08 11:02:50
---
# 纹理
以下讨论的纹理都是2D纹理。实际上存在3D纹理。

纹理的标准工作流：
1. Texture Aquisition 纹理获取
2. Texture Mapping 纹理映射

## 纹理获取
“获取”这种模棱两可的说法包含的是两个纹理的来源：
- 预先采集存储的位图（绘制、拍摄甚至CT采集）
- 使用算法生成/合成的纹理

具体来说，如下三种常见方法：
- 预先采集并存储的位图
  
  就是一般的2D数字图像

- 过程生成纹理
  
  利用过程(Procedure)而不是数字图像来表征纹理的手法，如采用

- 纹理合成

## 纹理映射
标准纹理映射工作流：
1. 投影映射
2. 变换处理
3. 纹理采样
4. 纹理转换

### 投影映射
顶点坐标系需要映射到纹理坐标系中才可以获知给定顶点的色彩。

由于顶点是三维点，而纹理是二维坐标系，所以通常这一映射是某种意义上投影。

两种常见映射方法：
- 映射方程

  直接写出三维点坐标到二维纹理坐标的解析表达式。
  
  适用于模型是简单几何体的情形。

- UV Mapping
  
  逐一指明每个顶点对应的纹理坐标。此时，纹理坐标直接作为顶点属性出现并预先存储。

  在实际工作中，纹理坐标通常是由美术建模者导出的。

  适用于复杂的模型（也是最常用的方法）。

### 变换处理
在进入纹理映射之前需要做一些预处理：

- 纹理环绕模式
  
  纹理坐标超出$[0,1]^2$范围的点如何取值

- 从标准纹理坐标到实际纹素坐标的缩放（可能出现小数，下一步需要采样）

### 纹理采样
无论获得纹理的手法如何，纹理在映射时中都是一张数字图像，纹理贴图的原始分辨率不一定适合最终的模型，因此势必存在以下问题：
- 纹理贴图分辨率过小
- 纹理贴图分辨率过高
- 光栅化，像素的纹理取值

### 上采样
当纹理贴图分辨率过小，需要做*上采样*。

常见的上采样算法（其实就是数字图像的上采样算法）：
- 最近邻插值（最简单，最粗糙）
- 双线性插值（相对简单，效果较好）
- 双三次插值（效果最好，最慢）

### 下采样
当纹理贴图分辨率过大，需要做*下采样*。

这种情形的核心问题在于**一个像素可能对应多个纹素，如何确定这一个像素的取值**


两种方法：
- 超采样反走样：将一个像素分成多个子像素，则只要分得足够小，问题可以化归为纹理分辨率低于屏幕的情形，然后插值，最后取平均得到像素值
- Mipmap
  
### Mipmap（分级细化贴图）
其实是一种简单思想：

**既然一个像素可能对应多个纹素，那就令像素的值是这些纹素的值的平均值**。

而Mipmapping是加速这一过程的技巧。

Mipmapping其实是**利用平均池化操作生成的数字图像金字塔**。

通过Mipmapping，我们预处理出了*多分辨率纹理*。

利用最接近的两个分辨率，然后**在两个分辨率中插值的结果再做线性插值**，得到一个“三线性插值”

### 各向异性滤波 & Ripmap

改进Mipmap，使用$1\times 2, 2\times 1, 2 \times 2$三个平均池化核而不是一个$2\times 2$，可以减少过度模糊的现象。

### 重采样问题的频域描述

将重问题转述为频域：
- 纹理贴图作为离散数字图像，空间离散化本身就是对原始信息的采样
- **根据采样定理，唯有该采样的频率高于两倍原连续信号采样频率，该采样才是无损的**
- 但原始信号不一定是带限的，因此纹理图像本身就不一定是无损的。甚至可以说通常都不是无损的：**清晰锐利的边缘对应了函数中的跳跃间断点，对应了无穷高频的成分**
- 实际上数字图像处理的全过程中*连续表示*都是逻辑上的，所有的输出都是离散的，也即都是信号的采样而不是信号本身
- 既然纹理贴图本身都不是无损的采样，那重采样的目标就不是“还原原始信号”，而是**还原信号的原始采样（纹理贴图）**
- 上采样问题——图像放大——的困难是**病态问题：图像放大本质上是在试图获得图像中不存在的信息。**
  
  对原采样做超采样，等效于将已经混叠的频谱做在频域做间隔更大的平移。

  尽管上采样问题是病态的，但它更容易做：**理论上可以仅通过插值来获得不低于原图像质量的重采样结果**

  **上采样结果的模糊并不意味着图像质量的降低**。放大后的模糊是**原图像采样频率有限，丢失了高频的本就不够清晰边缘的放大**的结果

- 下采样问题——图像缩小——的困难是：
  - **下采样等效对原始信号的欠采样，一定会加重频谱混叠，从而降低图像质量**
  - **从同时不适当的下采样结果会进一步降低图像质量。**

### 纹理转换（略）
有些纹理不是物体的光学（色彩）外观，不能直接用户上色，需要最后做转换。最典型的是*法线贴图*，此时采样值其实是法向量。

## 纹理的应用（待完善）
- Normal Map 法线贴图
- Bump Map 凹凸贴图
- Light Map 光照贴图
- *Displacement Map（这是唯一一种改变了模型的贴图）
  
  相比Bump Map，由于几何模型被改变了，在配合PBR之后可以产生“凹凸块之间的相互遮挡”

- Environment Map
  
  用于模拟光滑表面对环境的反射。

  其实就是预先将全局光照计算生成的反射表面存下来，然后渲染的时候直接贴上去。