---
abbrlink: '0'
date: 2021-09-23 10:46:36
title: 区块链结构

---
# 区块链结构

## 区块定义

如果将区块链理解为“账本”，则区块可以理解为“账本中的某一页”。

实际上一个区块保存着一批交易记录。

## 区块数据格式
```
Block Header:           90B
- version:              4B
- previous block hash:  32B
- merkle root hash:     32B
- time:                 4B
- bits:                 4B
- nounce:               4B

Transactions(Block Body): a bunch of TXs
```

说明：
- 区块头中的“bits”指的是*谜题难度*
- 区块头中的“nounce”来自密码学术语*nounce*是
- 区块体的交易按照*默克尔树*来组织

## 哈希指针
哈希指针其实是*上一个区块的首部的哈希值*。

之所以不需要把主体部分也哈希进去是因为头部包含了默克尔树哈希了，已经包含了主体部分的摘要了。

沿着哈希指针，链条的上最新的节点最终可以找到最初的节点。最初的节点就是**创世区块**

“创世区块”的内容是**完全静态不变的**，也即其哈希值不变的，且**其哈希值是公开的**。


## 交易
### 账户模型
在比特币中本质上不存在“账户”，身份完全由公钥产生的地址来决定，也无法简单地查询一个身份下的账户等基本信息。

### 比特币转账
其实就是：
- 数字签名充当“印章”
- 所有节点充当“公证人”

比特币转账的最小单位是一“聪”，等于一亿分之一个比特币

转账交易分为两部分：
- “输入”
- “输出”

### 输出
最重要的是内含一个**使用接收人的公钥上锁的脚本**。

一个输出可以对应多个输入（同时转账给多个人）

### 输入
不能凭空产生，**必须引用并解锁另一个输出**。由于输出中包含了接收人的公钥锁定的脚本，因此只有接收人用自己的私钥才能解锁，才能引用这一笔交易。

一笔输入交易可以引用多笔输出交易。

### UTXO模型
*UTXO(Unspent Transaction Output)*就是计算某账户余额的方法，其实就是收到的减去花出去的。具体来说就是计算用户拥有的输入交易的总数额减去输出出去的数额

这种模型的好处是，**一切交易都是可回溯的**，比特币交易链其实是**数字签名链**

## 默克尔树
其实就是把交易组织成二叉树叶子，然后每个内部节点把孩子哈希拼接起来再哈希，这样层层哈希，最终把整个块的所有交易哈希到一个32B的值中（默克尔树的根）