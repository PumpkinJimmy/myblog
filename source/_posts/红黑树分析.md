---
title: 红黑树分析
date: 2021-09-15 00:21:07
tags:
---
# 红黑树分析
## 红黑树性质
1. 每个节点不是红的，就是黑的
2. 根节点是黑的
3. 每个叶子节点都是NIL空节点，且都是黑的
4. 红节点的两个孩子都是黑的
5. 对任意节点，从该节点到任意叶子的路径上都有相同个数的黑节点

## 分析
$n$个内部节点的红黑树高至多是$2\lg(n+1)$
  
证明如下：

令$x$节点到其叶子节点路径上的黑节点的个数减1称为*黑高度*，记作$bh(x)$。

用归纳法证明节点$x$为根的子树至少有$2^{bh(x)}-1$个节点

- **一个节点的孩子的黑高度不是$bh(x)$就是$bh(x)-1$**
  
  这取决于这个节点是红的还是黑的。

  但无论这个节点是什么颜色，应用归纳假设都可以得出其至少有$2^{bh(x)}-1$个节点，从而归纳成立。

由上，$bh(x) \le \lg(n+1)$


考虑红黑树性质4，任意一条到叶子节点的路径上的黑节点数目都超过路径上节点数目的一半，因而$2bh(x) \ge h(x)$，从而$h \le 2lg(n+1)$

## 插入操作

在插入操作中，初始“当前节点”是被插入节点；只用当当前节点的父亲是红色的，才需要继续修改。
插入修复时，一共有两大类情况。

### “红叔”
- 父辈变黑，祖父变红
- 当前指针指向祖父


### “黑叔”
- 若是“zig-zag”结构，则先旋转父亲到“zig-zig”结构
- 然后“父变黑，祖父变红”
- 最后旋转祖父

注意，黑叔情况旋转完毕就停止了。

### 收尾
最后，将根节点置为黑色

## 删除操作
BST删除有两种情况：
1. 被删的节点孩子不满：直接链接孩子
2. 被删的节点孩子满：换上后继，链接后继节点的孩子

定义概念：$y$-节点和$x$-节点。考察被删除的节点：
- 若被删除节点是2孩的，则$y$节点是**被删除节点的后继**，
- 若被删除节点不满2孩，则$y$是**被删除的节点**，替代节点还是$y$的非空孩子
- $x$节点是$y$的非空孩子（若全为空，则任选一个）


关于`FIX-UP`过程
- `FIX-UP`触发的条件是$y$节点*原来的颜色*（注意到在被删除节点是双孩的时候$y$节点会换位改色）是黑色
- `FIX-UP`的初始对象是$x$节点
- `FIX-UP`终止的条件是$x$节点的颜色是红色

据此，存在三大类情形

### “红兄”
若$x$节点的兄弟是红色的，则：
- 父亲变红
- 兄弟变黑
- 旋转$x$的父亲

即可转化为黑兄弟的两种情形。

### “黑兄，双黑侄”
若$x$节点的兄弟的两个孩子都是黑的，则：
- 兄弟变红
- 新的$x$节点更新为原来的父亲

### “黑兄，红侄”
（待完善）

### 收尾
最后，将$x$节点设置为黑色