---
title: 数据库：索引
abbrlink: 21d1d2b7
date: 2021-11-15 03:12:51
---
# 数据库：索引
## 索引文件
索引文件是存放索引记录的文件。

索引记录结构：
1. 搜索码
2. 指针（数据记录的位置）

## 索引的性能指标
- 支持的访问类型
  - B+树索引支持高效的范围查询
  - 哈希索引支持最高效的单点查询但不支持范围查询
- 访问时间
- 修改的维护时间
- 空间开销

## 索引类型（待完善）
### 顺序索引
- 聚簇索引（*primary key* 主索引）
- 非聚簇索引（*secondary key* 辅索引）


## B+树索引（待完善）
### B+树结构与性质
- 多叉的严格平衡搜索树：根节点到任意叶子节点的距离都相等
- 设最大分叉数为$m$，则：
  - 节点可存放的key数目上限为$m-1$
  - **叶节点存放的key数目的取值范围是$[\lceil (m-1)/2\rceil, m-1]$**（小心，下限不等于最小扇出数-1）
  - **根节点分叉数目取值范围$[2,m]$**
  - **非根非叶节点分叉数目取值范围$[\lceil m/2\rceil, m]$**
  - 所有叶子节点利用最后一个指针的空间作为后继指针，串成一个有序链表
  - （区别于B树）**所有Key对应的Value只存放在叶节点上**
  - 作为将所有Key放在叶子上的收益，叶子节点串成的有序链表可以高效地实现范围查询：只需要找到端点值对应的指针就可以顺序输出
  - 作为将所有Key放在叶子上的代价，叶节点和非叶几点必须分开处理：叶节点上的Key在分裂时不能直接抽取到非叶节点上，而是冗余存储Key；但在非叶节点上却依然可以有这样的抽取Key的建树行为。

### B+树查找
从查找的角度，B+树可以看作特殊构造的非聚簇的多级顺序索引

### B+树插入
主要是利用*分裂*和*增高*来维护性质。

算法思路：
- 对待插入的Key找到对应的叶节点$L$
- 若$L$已经有$m-1$个Key了，则*分裂*成两个节点，需要按序将Key平分到两个节点上；否则，直接插入。
- 若执行了分裂，则新增的节点需要向父节点插入一个新的Key
- 对父节点插入并递归上述算法（父节点可能还要分裂）
- 若最终把根节点分裂了，则B+树*增高*一层：为原根节点分裂出来的两个节点添加一个共同的父节点充当新的根节点

### B+树删除
主要是利用*重新分布(Redistribution)*、*合并*以及变矮来维护性质。

## Hash索引（待完善）

### Hash文件组织

### 桶溢出处理
两种起因：
- Hash表的容量耗尽
- （更常见）由于记录的*倾斜(skew)*导致的个别桶溢出

个别桶的溢出对标的是Hash表中的*冲突*。

自然，有两种处理溢出的手法：
- Closed Hashing 使用一个溢出链来存放溢出的记录，相当于*链接法*
- Opened Hashing 其实就是*开放寻址法*

通常，数据库使用Closed Hashing解决溢出。因为数据库中增删改查都比较多。

### Hash索引文件
Hash索引是以Hash文件组织结果构建的非聚簇索引。