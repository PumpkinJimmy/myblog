# 虚拟化
## 系统接口
从软件到硬件直接一共涉及三层的“接口”：
- ISA：处理器的*指令集*
- ABI：应用程序二进制接口，很大一部分是*系统调用*
- API：应用程序编程接口，主要是库函数接口

## 虚拟化技术
1. Process VM 进程虚拟机
2. Hosted VMM 主机虚拟机监控器
3. Native VMM 原生虚拟机监控器

## Process VM 进程虚拟机
- 它是**对ISA的虚拟化**
- 它有时是运行在OS上的*解释器*，典型例子是JVM
- 有些Process VM是一种*模拟器*，可以模拟出各种ISA，典例是QEMU。但通常模拟器的性能损失非常大，可以达到一个数量级

## Hosted VMM 主机虚拟机监控器
- 它需要寄宿于宿主机OS上
- 它是**对硬件的虚拟化**
- 最主流的虚拟化平台技术
- 宿主机的OS的主要作用是执行涉及特权指令的操作（即系统调用），非特权指令是用户模式下在虚拟环境中执行的
- 技术瓶颈主要是一些特殊操作难以处理（称为*敏感指令*）：
  - 一些指令会影响机器配置（如修改中断表的指令）
  - 一些指令的效果取决于处理器上下文
- 想要做Hosted VMM，必须要敏感指令是特权指令的子集才行，但通常宿主OS不满足条件
  - 早期方案需要修改宿主OS，现已彻底抛弃
  - 现代方案是硬件虚拟化
- 典型的产品包括
  - VMWare/VirtualBox
    - 虚拟PC的概念，可以将虚拟机当作主机的一个应用程序来运行
    - 真正的同时运行两个系统
    - 有一定的性能损失
  - KVM
    - 绑定Linux宿主系统，是Linux内核的一部分
    - 需要硬件虚拟化的支持
    - 寄宿系统支持Linux，Windows等
    - 性能高，开源免费
    - 采用的是“多启动”，或者说同一时刻实际上只能运行某一个虚拟OS
  - Hyper-V：Windows下的虚拟化平台

## Native VMM 原生虚拟机监控器
- 它**直接运行在硬件上，不需要寄宿于另一个OS**
- 它是**对硬件的虚拟**
- 由于直接运行在硬件上，通常它需要内含一个最小OS
- 对硬件的直接虚拟允许设备以不同“形态”运行，比如说有时计算机设备并不充当通用计算机，而是承担类似网络交换机这样的专用计算任务，此时可以借助Native VMM